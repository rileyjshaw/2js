var h=`
attribute vec2 aPosition;
varying vec2 vUv;
void main() {
    vUv = aPosition * 0.5 + 0.5;
    gl_Position = vec4(aPosition, 0.0, 1.0);
}
`,n=class{constructor(r,i=null){this.uniforms=new Map;this.program=null;this.canvas=i||document.createElement("canvas"),i||(document.body.appendChild(this.canvas),this.canvas.style.position="fixed",this.canvas.style.inset="0",this.canvas.style.height="100dvh",this.canvas.style.width="100dvw"),this.gl=this.canvas.getContext("webgl"),this.fragmentShaderSrc=r,this.animationFrameId=null,this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.resizeObserver.observe(this.canvas),this.init(),this.addEventListeners()}init(){let r=h;if(this.program=this.gl.createProgram(),!this.program)throw new Error("Failed to create WebGL program");let i=this.createShader(this.gl.VERTEX_SHADER,r),t=this.createShader(this.gl.FRAGMENT_SHADER,this.fragmentShaderSrc);if(this.gl.attachShader(this.program,i),this.gl.attachShader(this.program,t),this.gl.linkProgram(this.program),this.gl.getProgramParameter(this.program,this.gl.LINK_STATUS)||(console.error("Program link error:",this.gl.getProgramInfoLog(this.program)),this.gl.deleteProgram(this.program),this.program=null),!this.program)throw new Error("Failed to link WebGL program");let e=this.gl.getAttribLocation(this.program,"aPosition");this.setupBuffer(e),this.resizeCanvas(),this.gl.useProgram(this.program),this.initializeUniform("uResolution","float",[this.canvas.width,this.canvas.height]),this.initializeUniform("uCursor","float",[.5,.5]),this.initializeUniform("uTime","float",0)}createShader(r,i){let t=this.gl.createShader(r);if(this.gl.shaderSource(t,i),this.gl.compileShader(t),!this.gl.getShaderParameter(t,this.gl.COMPILE_STATUS))throw console.error("Shader compilation failed:",i),console.error(this.gl.getShaderInfoLog(t)),this.gl.deleteShader(t),new Error("Shader compilation failed");return t}setupBuffer(r){let i=new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),t=this.gl.createBuffer();this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.bufferData(this.gl.ARRAY_BUFFER,i,this.gl.STATIC_DRAW),this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,t),this.gl.enableVertexAttribArray(r),this.gl.vertexAttribPointer(r,2,this.gl.FLOAT,!1,0,0)}resizeCanvas(){let r=window.devicePixelRatio||1,i=this.canvas.clientWidth*r,t=this.canvas.clientHeight*r;(this.canvas.width!==i||this.canvas.height!==t)&&(this.canvas.width=i,this.canvas.height=t,this.gl.viewport(0,0,this.gl.drawingBufferWidth,this.gl.drawingBufferHeight),this.uniforms.has("uResolution")&&this.updateUniforms({uResolution:[this.canvas.width,this.canvas.height]}))}addEventListeners(){let r=!1,i=(t,e)=>{if(!this.uniforms.has("uCursor"))return;let s=this.canvas.getBoundingClientRect(),a=(t-s.left)/s.width,o=1-(e-s.top)/s.height;this.updateUniforms({uCursor:[a,o]})};this.canvas.addEventListener("mousemove",t=>{r||i(t.clientX,t.clientY)}),this.canvas.addEventListener("touchstart",()=>{r=!0}),this.canvas.addEventListener("touchmove",t=>{t.touches.length>0&&i(t.touches[0].clientX,t.touches[0].clientY)})}initializeUniform(r,i,t){if(this.uniforms.has(r))throw new Error(`Uniform '${r}' is already initialized.`);if(!this.program)throw new Error("WebGL program is not initialized");if(i!=="float"&&i!=="int")throw new Error(`Invalid uniform type: ${i}. Expected 'float' or 'int'.`);let e=this.gl.getUniformLocation(this.program,r);if(!e){console.log(`Uniform ${r} not found in fragment shader. Skipping initialization.`);return}if(Array.isArray(t)||(t=[t]),t.length<1||t.length>4)throw new Error(`Invalid uniform value length: ${t.length}. Expected a length between 1 and 4.`);let s=t.length;this.uniforms.set(r,{type:i,length:s,location:e}),this.updateUniforms({[r]:t})}updateUniforms(r){Object.entries(r).forEach(([i,t])=>{if(!this.uniforms.has(i))throw new Error(`Uniform '${i}' is not initialized.`);let e=this.uniforms.get(i);if(Array.isArray(t)||(t=[t]),t.length!==e.length)throw new Error(`Invalid uniform value length: ${t.length}. Expected ${e.length}.`);this.gl[`uniform${e.length}${e.type.charAt(0)}`](e.location,...t)})}play(r){let i=t=>{t/=1e3,this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.uniforms.has("uTime")&&this.updateUniforms({uTime:t}),r&&r(t),this.gl.drawArrays(this.gl.TRIANGLES,0,6),this.animationFrameId=requestAnimationFrame(i)};this.animationFrameId=requestAnimationFrame(i)}pause(){this.animationFrameId&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}},g=n;export{g as default};
//# sourceMappingURL=index.mjs.map